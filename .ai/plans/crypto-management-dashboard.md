# Plan: Gestion Dynamique des Cryptomonnaies & Mode Veille Bot

_Cr√©√©: 2025-01-12 | Version: 1.0 | Updated: 2025-01-25_  
_Status: PHASE 2 COMPLETED ‚úÖ | Priorit√©: HAUTE_

## üéâ IMPLEMENTATION STATUS: PHASE 2 COMPLETED

### ‚úÖ **Achievements Summary**

- **Phase 1**: Backend Foundation ‚úÖ COMPLETED

  - 13 API endpoints implemented
  - ConfigManager with cross-platform crypto management
  - Database schema with crypto_configs & bot_commands tables
  - Enhanced BotController with STANDBY/ACTIVE modes

- **Phase 2**: Bot Integration ‚úÖ COMPLETED
  - AlloraMind extended with dynamic mode control
  - Real-time command processing (10-second intervals)
  - Dynamic crypto configuration without restarts
  - 15/15 comprehensive tests passing
  - Production-ready command execution system

### üéØ **Ready for Phase 3**: Frontend Interface Implementation

- CryptoManager.tsx component development
- Real-time dashboard integration
- User interface for crypto toggles and bot control

## üéØ Objectifs Principaux

### 1. **Dashboard de Gestion des Cryptos**

- Interface web pour activer/d√©sactiver les cryptomonnaies surveill√©es
- Affichage temps r√©el des cryptos disponibles sur HyperLiquid + AlloraNetwork
- Gestion par toggles intuitifs avec recherche et filtres

### 2. **Mode Veille du Bot**

- Bot d√©marre en mode STANDBY (attente d'instructions)
- Activation/d√©sactivation via dashboard
- Pas de trading automatique sans ordre explicite

### 3. **Gestion Dynamique**

- Modification des cryptos surveill√©es sans red√©marrage du bot
- Communication temps r√©el dashboard ‚Üî bot
- Persistance des configurations

## üìä Architecture Propos√©e

### **Backend Extensions**

#### A. Configuration Manager (`dashboard/backend/config_manager.py`)

```python
class ConfigManager:
    def __init__(self):
        self.active_cryptos = {}  # {token: topic_id}
        self.available_cryptos = {}
        self.db = DatabaseService()

    async def load_available_cryptos(self):
        # Charge HyperLiquid testnet tokens (178 cryptos)
        # Charge AlloraNetwork topic IDs (26 topics)
        # Croise les donn√©es pour "both" availability

    async def update_active_cryptos(self, updates):
        # Met √† jour la config active
        # Notifie le bot via WebSocket
        # Sauvegarde en base

    async def get_crypto_status(self):
        # Retourne status complet pour dashboard
```

#### B. Crypto Router (`dashboard/backend/routers/crypto_config.py`)

```python
# Nouveaux endpoints:
GET /api/crypto/available         # Liste compl√®te cryptos disponibles
GET /api/crypto/active           # Cryptos actuellement surveill√©es
POST /api/crypto/activate        # Activer une crypto: {symbol, topic_id}
POST /api/crypto/deactivate      # D√©sactiver: {symbol}
PUT /api/crypto/batch-update     # Mise √† jour multiple
GET /api/crypto/compatibility    # Check HyperLiquid + Allora compat
```

#### C. Bot Controller Extension (`dashboard/backend/bot_controller.py`)

```python
class BotController:
    def __init__(self):
        self.bot_mode = "STANDBY"  # STANDBY, ACTIVE, STOPPED
        self.bot_process = None
        self.config_manager = ConfigManager()

    async def start_monitoring(self):
        # D√©marre bot en mode surveillance
        self.bot_mode = "ACTIVE"

    async def set_standby(self):
        # Met bot en veille
        self.bot_mode = "STANDBY"

    async def update_crypto_config(self, config):
        # Envoie nouvelle config au bot via signal/WebSocket
```

### **Bot Core Modifications**

#### A. Standby Mode (`allora/allora_mind.py`)

```python
class AlloraMind:
    def __init__(self):
        self.mode = "STANDBY"  # STANDBY, ACTIVE
        self.topic_ids = {}
        self.command_listener = CommandListener()

    def start_with_standby(self):
        """D√©marre en mode veille avec √©coute commands"""
        print("üü° Bot started in STANDBY mode")
        while True:
            if self.mode == "ACTIVE" and self.topic_ids:
                self.run_trading_cycle()
            else:
                self.check_dashboard_commands()
            time.sleep(10)

    def update_cryptos_dynamically(self, new_topics):
        """Met √† jour topic_ids sans red√©marrage"""
        self.topic_ids = new_topics
        print(f"üì° Updated monitored cryptos: {list(new_topics.keys())}")

    def activate_monitoring(self):
        """Active le mode trading"""
        self.mode = "ACTIVE"
        print("üü¢ Bot activated - Starting monitoring")

    def set_standby(self):
        """Retour en mode veille"""
        self.mode = "STANDBY"
        print("üü° Bot set to STANDBY mode")
```

#### B. Command Interface (`allora/command_listener.py`)

```python
class CommandListener:
    def __init__(self):
        self.websocket_client = None
        self.db_listener = DatabaseListener()

    async def listen_for_commands(self):
        # √âcoute WebSocket commands du dashboard
        # Format: {"type": "UPDATE_CRYPTOS", "data": {cryptos}}
        #         {"type": "SET_MODE", "data": "ACTIVE"}

    def check_db_commands(self):
        # Alternative: polling base pour commands
```

### **Frontend Extensions**

#### A. Crypto Manager Component (`dashboard/frontend/src/components/CryptoManager.tsx`)

```typescript
interface CryptoConfig {
  symbol: string;
  topicId: number;
  isActive: boolean;
  availability: "both" | "hyperliquid" | "allora";
  price?: number;
  volume24h?: number;
}

const CryptoManager: React.FC = () => {
  const [availableCryptos, setAvailableCryptos] = useState<CryptoConfig[]>([]);
  const [activeCryptos, setActiveCryptos] = useState<CryptoConfig[]>([]);
  const [searchTerm, setSearchTerm] = useState("");
  const [filterBy, setFilterBy] = useState<
    "all" | "both" | "hyperliquid" | "allora"
  >("all");

  const handleToggleCrypto = async (symbol: string, activate: boolean) => {
    // Call API to activate/deactivate
    // Update local state
    // Show notification
  };

  const handleBatchUpdate = async (updates: CryptoConfig[]) => {
    // Bulk operations for multiple cryptos
  };

  return (
    <div className="crypto-manager">
      <SearchAndFilter />
      <CryptoGrid cryptos={filteredCryptos} onToggle={handleToggleCrypto} />
      <QuickActions />
    </div>
  );
};
```

#### B. Enhanced Bot Control (`dashboard/frontend/src/components/BotControl.tsx`)

```typescript
const BotControl: React.FC = () => {
  const [botMode, setBotMode] = useState<"STANDBY" | "ACTIVE" | "STOPPED">(
    "STANDBY"
  );
  const [activeCryptos, setActiveCryptos] = useState<string[]>([]);

  const handleStartMonitoring = async () => {
    if (activeCryptos.length === 0) {
      alert("Please activate at least one cryptocurrency first");
      return;
    }
    await apiService.startBotMonitoring();
  };

  return (
    <div className="bot-control">
      <BotModeIndicator mode={botMode} />
      <ActiveCryptosSummary cryptos={activeCryptos} />
      <ControlButtons />
    </div>
  );
};
```

## üîÑ Flux de Donn√©es

### Activation d'une Crypto

```
User Dashboard ‚Üí Frontend ‚Üí Backend API ‚Üí ConfigManager ‚Üí WebSocket ‚Üí Bot
     ‚Üì                                                                ‚Üì
Confirmation ‚Üê Frontend ‚Üê Backend API ‚Üê ConfigManager ‚Üê WebSocket ‚Üê Bot ACK
```

### D√©marrage du Mode Surveillance

```
User "Start" ‚Üí Frontend ‚Üí Backend ‚Üí BotController ‚Üí Bot Process
                                         ‚Üì
                              Signal: SET_MODE=ACTIVE
                                         ‚Üì
                            Bot: mode="ACTIVE" + start trading
```

## üìã Plan d'Impl√©mentation

### **Phase 1: Backend Foundation** ‚úÖ COMPLETED

- [x] `ConfigManager` class avec gestion crypto ‚úÖ
- [x] `crypto_config.py` router avec tous endpoints ‚úÖ (13 endpoints)
- [x] Extension `BotController` pour modes STANDBY/ACTIVE ‚úÖ
- [x] Database schema pour config cryptos ‚úÖ
- [x] Tests API endpoints ‚úÖ

### **Phase 2: Bot Integration** ‚úÖ COMPLETED

- [x] Modification `allora_mind.py` pour mode STANDBY ‚úÖ
- [x] Command system pour communication dashboard ‚úÖ (DB polling)
- [x] Real-time command processing (10s intervals) ‚úÖ
- [x] Dynamic `topic_ids` update sans red√©marrage ‚úÖ
- [x] Tests mode veille et activation ‚úÖ (15/15 tests passing)

### **Phase 3: Frontend Interface** (Jour 3-4)

- [ ] `CryptoManager.tsx` component principal
- [ ] Search, filter, et toggle controls
- [ ] Enhanced `BotControl.tsx` avec modes
- [ ] Dashboard tab pour "Crypto Configuration"
- [ ] Real-time updates via WebSocket

### **Phase 4: Integration & Testing** (Jour 4-5)

- [ ] End-to-end workflow testing
- [ ] Error handling et edge cases
- [ ] Performance optimization
- [ ] User experience refinement
- [ ] Documentation utilisateur

## üóÑÔ∏è Database Schema

```sql
-- Table configuration cryptos
CREATE TABLE crypto_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol TEXT UNIQUE NOT NULL,           -- 'BTC', 'ETH', etc.
    topic_id INTEGER NOT NULL,             -- AlloraNetwork topic ID
    is_active BOOLEAN DEFAULT FALSE,       -- Actuellement surveill√©e
    availability TEXT NOT NULL,            -- 'both', 'hyperliquid', 'allora'
    hyperliquid_available BOOLEAN DEFAULT FALSE,
    allora_available BOOLEAN DEFAULT FALSE,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_price REAL,                       -- Cache du dernier prix
    volume_24h REAL                        -- Cache volume 24h
);

-- Table commandes bot
CREATE TABLE bot_commands (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    command_type TEXT NOT NULL,            -- 'UPDATE_CRYPTOS', 'SET_MODE', etc.
    command_data TEXT,                     -- JSON data
    status TEXT DEFAULT 'PENDING',         -- 'PENDING', 'EXECUTED', 'FAILED'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    executed_at TIMESTAMP,
    error_message TEXT
);
```

## üéõÔ∏è Interface Utilisateur

### Crypto Management Dashboard

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üöÄ HyperLiquid AI Trading Bot - Crypto Configuration              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ üîç [Search cryptocurrencies...]     üìä Filter: [Both Platforms ‚ñº] ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ Active Cryptocurrencies (2/178)              üü¢ Bot: STANDBY       ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ ‚úÖ BTC  Topic 1   $100,822   Vol: $2.1B    [üü¢‚óè‚óè‚óè] [Deactivate]‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚úÖ ETH  Topic 2   $2,227     Vol: $891M    [üü¢‚óè‚óè‚óè] [Deactivate]‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ Available Cryptocurrencies                                          ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ ‚ö™ SOL   Topic 3   $133      Vol: $156M    [‚ö™‚óè‚óè‚óè] [Activate]   ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ö™ AVAX  Topic 7   $16.41    Vol: $89M     [‚ö™‚óè‚óè‚óè] [Activate]   ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ö™ MATIC Topic 9   $0.168    Vol: $45M     [‚ö™‚óè‚óè‚óè] [Activate]   ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ö™ ATOM  Topic 13  $3.79     Vol: $23M     [‚ö™‚óè‚óè‚óè] [Activate]   ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ üìä Quick Actions: [Select Popular (BTC,ETH,SOL,AVAX)] [Clear All]  ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ Bot Control:                                                        ‚îÇ
‚îÇ [üöÄ Start Monitoring] [‚è∏Ô∏è Set Standby] [üõë Stop Bot]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## ‚öôÔ∏è Configuration Updates

### Environment Variables (.env.testnet)

```bash
# Bot Mode Configuration
BOT_DEFAULT_MODE=STANDBY
CONFIG_UPDATE_INTERVAL=10
WEBSOCKET_COMMAND_ENABLED=true
WEBSOCKET_COMMAND_CHANNEL=bot_commands

# Default Active Cryptocurrencies (optional)
DEFAULT_ACTIVE_CRYPTOS=BTC:1,ETH:2

# Command Interface
BOT_COMMAND_DB_POLLING=true
BOT_COMMAND_WEBSOCKET=true
```

## üéØ Avantages de Cette Architecture

### ‚úÖ **Avantages Utilisateur**

- **üéõÔ∏è Contr√¥le Total**: Gestion intuitive des cryptos via interface web
- **‚ö° Temps R√©el**: Changements instantan√©s sans red√©marrage
- **üõ°Ô∏è S√©curit√©**: Mode veille par d√©faut, activation manuelle requise
- **üìä Visibilit√©**: Status en temps r√©el de toutes les cryptos et du bot

### ‚úÖ **Avantages Techniques**

- **üîÑ Hot Reload**: Modification config sans arr√™t du bot
- **üì° Communication**: WebSocket temps r√©el dashboard ‚Üî bot
- **üíæ Persistance**: Sauvegarde config en base de donn√©es
- **üß™ Testabilit√©**: Architecture modulaire facile √† tester

### ‚úÖ **Avantages Op√©rationnels**

- **üöÄ D√©ploiement**: Zero-downtime configuration changes
- **üìà Scalabilit√©**: Ajout facile de nouvelles cryptos
- **üîß Maintenance**: Gestion centralis√©e des configurations
- **üìã Audit**: Historique complet des changements

## üö® Consid√©rations & Risques

### ‚ö†Ô∏è **Risques Identifi√©s**

- **Latence WebSocket**: Commands peuvent √™tre perdues ‚Üí Fallback DB polling
- **√âtat Incoh√©rent**: Bot et dashboard d√©synchronis√©s ‚Üí Heartbeat system
- **Charge CPU**: Polling trop fr√©quent ‚Üí Optimisation intervales
- **Erreurs R√©seau**: Perte connexion AlloraNetwork ‚Üí Retry logic

### üõ°Ô∏è **Mitigation Strategies**

- **Double Communication**: WebSocket + DB polling comme backup
- **Health Checks**: V√©rification p√©riodique coh√©rence √©tat
- **Circuit Breaker**: Arr√™t automatique si trop d'erreurs
- **Graceful Degradation**: Mode d√©grad√© si services externes down

## üìö Documentation Utilisateur

### Guide d'Utilisation

1. **D√©marrage**: Bot lance automatiquement en mode STANDBY
2. **Configuration**: Aller dans l'onglet "Crypto Configuration"
3. **Activation**: Toggle les cryptos d√©sir√©es (BTC, ETH, SOL...)
4. **Monitoring**: Cliquer "Start Monitoring" pour activer le bot
5. **Gestion**: Modifier les cryptos √† tout moment, m√™me pendant trading

### Workflow Recommand√©

```
STANDBY ‚Üí Configure Cryptos ‚Üí Activate Monitoring ‚Üí
Monitor Performance ‚Üí Adjust Cryptos ‚Üí Continue Trading
```

Cette architecture fournit une base solide pour une gestion flexible et professionnelle du bot de trading, tout en conservant la robustesse et les optimizations existantes.
